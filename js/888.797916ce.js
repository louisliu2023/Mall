"use strict";(self["webpackChunkshopvue"]=self["webpackChunkshopvue"]||[]).push([[888],{5978:function(s,t,a){a.d(t,{Z:function(){return c}});var e=function(){var s=this,t=s._self._c;return t("div",s._l(s.myCouponList,(function(a,e){return t("div",{key:e,staticClass:"coupon-item",on:{click:function(t){return s.handleClick(a.user_coupon_id)}}},[t("div",{staticClass:"item-wrapper",class:["color-"+(a.state.value?s.color[e%s.color.length]:"gray")]},[t("div",{staticClass:"coupon-type"},[s._v(" "+s._s(s.CouponType(a.coupon_type))+" ")]),t("div",{staticClass:"tip dis-flex flex-dir-column flex-x-center"},[10==a.coupon_type?t("div",[t("span",{staticClass:"f-30"},[s._v("￥")]),t("span",{staticClass:"money"},[s._v(s._s(a.reduce_price))])]):s._e(),20==a.coupon_type?t("span",{staticClass:"money"},[s._v(s._s(a.discount)+"折")]):s._e(),t("span",{staticClass:"pay-line"},[s._v("满"+s._s(a.min_price)+"元可用")])]),t("div",{staticClass:"split-line"}),t("div",{staticClass:"content dis-flex flex-dir-column flex-x-between"},[t("div",{staticClass:"title"},[s._v(s._s(a.name))]),t("div",{staticClass:"bottom dis-flex flex-y-center"},[t("div",{staticClass:"time flex-box"},[a.start_time===a.end_time?t("span",[s._v(s._s(a.start_time)+" 当天有效")]):t("span",[s._v(s._s(a.start_time)+"~"+s._s(a.end_time))])]),t("div",{staticClass:"receive state"},[t("span",[s._v(s._s(a.state.text))])])])])])])})),0)},o=[],i={name:"MyCouponList",props:{myCouponList:{type:Array}},data(){return{color:["red","blue","violet","yellow"]}},methods:{CouponType(s){return 10===s?"满减券":"折扣券"},handleClick(s){this.$emit("onClickCoupon",s)}}},n=i,r=a(1001),d=(0,r.Z)(n,e,o,!1,null,"0657c3f0",null),c=d.exports},8888:function(s,t,a){a.r(t),a.d(t,{default:function(){return _}});var e=function(){var s=this,t=s._self._c;return s.order.orderTotalNum?t("div",{staticClass:"pay"},[t("van-nav-bar",{attrs:{fixed:"",title:"订单结算台","left-arrow":""},on:{"click-left":function(t){return s.$router.back()}}}),t("div",{staticClass:"address",on:{click:s.selNewAdd}},[t("div",{staticClass:"left-icon"},[t("van-icon",{attrs:{name:"logistics"}})],1),s.addressShownData.region?t("div",{staticClass:"info"},[t("div",{staticClass:"info-content"},[t("span",{staticClass:"name"},[s._v(s._s(s.addressShownData.name+" "))]),t("span",{staticClass:"mobile"},[s._v(s._s(s.addressShownData.phone))])]),t("div",{staticClass:"info-address"},[s._v(" "+s._s(s.addressShownData.region.province+" "+s.addressShownData.region.city+" "+s.addressShownData.region.region+" "+s.addressShownData.detail)+" ")])]):t("div",{staticClass:"info"},[s._v("请选择配送地址")]),t("div",{staticClass:"right-icon"},[t("van-icon",{attrs:{name:"arrow"}})],1)]),t("div",{staticClass:"pay-list"},[t("div",{staticClass:"list"},s._l(s.order.goodsList,(function(a,e){return t("div",{key:e,staticClass:"goods-item"},[t("div",{staticClass:"left"},[t("img",{attrs:{src:a.goods_image,alt:""}})]),t("div",{staticClass:"right"},[t("p",{staticClass:"tit text-ellipsis-2"},[s._v(" "+s._s(a.goods_name)+" ")]),t("p",{staticClass:"info"},[t("span",{staticClass:"count"},[s._v("x"+s._s(a.total_num))]),t("span",{staticClass:"price"},[s._v("¥"+s._s(a.goods_price_min))])])])])})),0),t("div",{staticClass:"flow-num-box"},[t("span",[s._v("共 "+s._s(s.order.orderTotalNum)+" 件商品，合计：")]),t("span",{staticClass:"money"},[s._v("￥"+s._s(s.order.orderTotalPrice))])]),t("div",{staticClass:"pay-detail"},[t("div",{staticClass:"pay-cell"},[t("span",[s._v("订单总金额：")]),t("span",{staticClass:"red"},[s._v("￥"+s._s(s.order.orderTotalPrice))])]),t("div",{staticClass:"pay-cell"},[t("span",{},[s._v("优惠券：")]),t("div",{},[s.order.couponList.length?t("div",{staticClass:"choose-coupon red",on:{click:function(t){s.isShowAction=!0}}},[s.order.couponId>0?t("span",{},[s._v("-￥"+s._s(s.order.couponMoney))]):t("span",{},[s._v("有"+s._s(s.order.couponList.length)+"张优惠券")]),t("van-icon",{attrs:{name:"arrow"}})],1):t("span",{},[s._v("无优惠券可用")])])]),t("van-action-sheet",{attrs:{title:"选择优惠券"},model:{value:s.isShowAction,callback:function(t){s.isShowAction=t},expression:"isShowAction"}},[s.order.couponList.length?t("MyCouponList",{staticClass:"coupon-list",attrs:{myCouponList:s.order.couponList},on:{onClickCoupon:s.onUsingCoupon}}):s._e(),t("div",{staticClass:"no-coupon",on:{click:s.noUsingCoupon}},[t("span",[s._v("不使用优惠券")])])],1),t("div",{staticClass:"pay-cell"},[t("span",[s._v("配送费用：")]),s.addressShownData.region?t("span",[s._v("请先选择配送地址")]):t("span",{staticClass:"red"},[s._v("+￥"+s._s(s.order.expressPrice))])])],1),t("div",{staticClass:"pay-way"},[t("span",{staticClass:"tit"},[s._v("支付方式")]),t("van-radio-group",{attrs:{"checked-color":"#ee0a24"},model:{value:s.payType,callback:function(t){s.payType=t},expression:"payType"}},[t("van-cell-group",[t("van-cell",{attrs:{clickable:""},on:{click:function(t){s.payType="10"}},scopedSlots:s._u([{key:"title",fn:function(){return[t("van-icon",{attrs:{name:"balance-o",color:"#ff9700"}}),t("span",[s._v("余额支付（可用 ¥ "+s._s(s.personal.balance)+"）")])]},proxy:!0},{key:"right-icon",fn:function(){return[t("van-radio",{attrs:{name:"10"}})]},proxy:!0}],null,!1,885134180)}),t("van-cell",{attrs:{clickable:""},on:{click:function(t){s.payType="0"}},scopedSlots:s._u([{key:"title",fn:function(){return[t("van-icon",{attrs:{name:"info-o",color:"#ee0a24"}}),t("span",[s._v("稍后支付")])]},proxy:!0},{key:"right-icon",fn:function(){return[t("van-radio",{attrs:{name:"0"}})]},proxy:!0}],null,!1,2036502173)})],1)],1)],1),t("div",{staticClass:"buytips"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:s.remark,expression:"remark"}],attrs:{maxlength:"50",placeholder:"选填：买家留言（50字内）",name:"",id:"",cols:"30",rows:"10"},domProps:{value:s.remark},on:{input:function(t){t.target.composing||(s.remark=t.target.value)}}})])]),t("div",{staticClass:"footer-fixed"},[t("div",{staticClass:"left"},[s._v(" 实付款："),t("span",[s._v("￥"+s._s(s.order.orderPayPrice))])]),t("div",{staticClass:"tipsbtn",on:{click:s.submitOrdr}},[s._v("提交订单")])])],1):s._e()},o=[],i=(a(7658),a(3822)),n=a(4471);const r=s=>(0,n.Z)({url:"/checkout/order",params:{...s}}),d=s=>(0,n.Z)({method:"post",url:"/checkout/submit",data:{...s}});var c=a(170),l=a(5978),u={name:"CheckoutIndex",components:{MyCouponList:l.Z},data(){return{isShowAction:!1,mode:this.$route.query.mode,addressId:0,defaultAddId:0,addressShownData:{},orderPayData:{delivery:10,couponId:0,isUsePoints:0},payType:"0",remark:"",order:{},personal:{}}},computed:{goodsInfo(){return"cart"===this.mode?{cartIds:this.$route.query.cartIds}:{goodsId:this.$route.query.goodsId,goodsNum:this.$route.query.goodsNum,goodsSkuId:this.$route.query.goodsSkuId}},...(0,i.rn)("address",["chosenAddId"])},methods:{async checkoutOrder(){const s={mode:this.mode,...this.orderPayData,...this.goodsInfo},{data:t}=await r(s);this.order=t.order,this.personal=t.personal,this.defaultAddId=t.order.address?t.order.address.address_id:0;const a=this.chosenAddId?this.chosenAddId:this.defaultAddId;await this.getAddDetail(a)},async getAddDetail(s){if(!s)return;const{data:{detail:t}}=await(0,c.rn)(s);this.addressShownData=t},async submitOrdr(){const s={mode:this.mode,...this.orderPayData,...this.goodsInfo,payType:+this.payType,remark:this.remark},{data:{orderId:t}}=await d(s);this.$router.replace(`/orderdetail?orderId=${t}`)},async onUsingCoupon(s){this.orderPayData.couponId=s,await this.checkoutOrder(),this.isShowAction=!1},async noUsingCoupon(){this.orderPayData.couponId=0,await this.checkoutOrder(),this.isShowAction=!1},selNewAdd(){this.$router.push({path:"/address",query:{backUrl:this.$route.fullPath}})}},created(){this.checkoutOrder()}},p=u,v=a(1001),h=(0,v.Z)(p,e,o,!1,null,"5b9a2d23",null),_=h.exports}}]);
//# sourceMappingURL=888.797916ce.js.map