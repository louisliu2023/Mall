"use strict";(self["webpackChunkshopvue"]=self["webpackChunkshopvue"]||[]).push([[348],{6348:function(t,e,s){s.r(e),s.d(e,{default:function(){return p}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login"},[e("van-nav-bar",{attrs:{title:"登录","left-arrow":""},on:{"click-left":function(e){return t.$router.back()}}}),e("div",{staticClass:"container"},[t._m(0),e("div",{staticClass:"form"},[e("div",{staticClass:"form-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.mobile,expression:"mobile"}],staticClass:"inp",attrs:{maxlength:"11",placeholder:"请输入手机号码",type:"text"},domProps:{value:t.mobile},on:{input:function(e){e.target.composing||(t.mobile=e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.captchaCode,expression:"captchaCode"}],staticClass:"inp",attrs:{maxlength:"5",placeholder:"请输入图形验证码",type:"text"},domProps:{value:t.captchaCode},on:{input:function(e){e.target.composing||(t.captchaCode=e.target.value)}}}),t.captchaUrl?e("img",{attrs:{src:t.captchaUrl,alt:""},on:{click:t.getCaptcha}}):t._e()]),e("div",{staticClass:"form-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.smsCode,expression:"smsCode"}],staticClass:"inp",attrs:{placeholder:"请输入短信验证码",type:"text"},domProps:{value:t.smsCode},on:{input:function(e){e.target.composing||(t.smsCode=e.target.value)}}}),e("button",{on:{click:t.getMsgCode}},[t._v(" "+t._s(t.msgTimer?t.secondCounting+"秒后重新获取":"获取验证码")+" ")])])]),e("div",{staticClass:"login-btn",on:{click:t.userLogin}},[t._v("登录")])])],1)},i=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"title"},[e("h3",[t._v("手机号登录")]),e("p",[t._v("未注册的手机号登录后将自动注册")])])}],o=s(4471);const c=()=>o.Z.get("/captcha/image"),n=(t,e,s)=>(0,o.Z)({method:"post",url:"/captcha/sendSmsCaptcha",data:{form:{captchaCode:t,captchaKey:e,mobile:s}}}),r=(t,e)=>o.Z.post("/passport/login",{form:{smsCode:t,mobile:e,isParty:!1,partyData:{}}});var l={name:"LoginIndex",data(){return{captchaUrl:"",captchaKey:"",msgTimer:null,secondLimit:10,secondCounting:10,mobile:"",captchaCode:"",smsCode:""}},methods:{async getCaptcha(){const t=await c(),{data:{base64:e,key:s}}=t;this.captchaUrl=e,this.captchaKey=s},verifyLogin(){return/^1[3-9]\d{9}$/.test(this.mobile)?!!/^\w{4}$/.test(this.captchaCode)||(this.$toast("请输入正确的图形验证码"),!1):(this.$toast("请输入正确的手机号"),!1)},async getMsgCode(){this.verifyLogin()&&(this.msgTimer||(await n(this.captchaCode,this.captchaKey,this.mobile),this.$toast("验证码：246810"),this.msgTimer=setInterval((()=>{this.secondCounting--,this.secondCounting<=0&&(clearInterval(this.msgTimer),this.msgTimer=null,this.secondCounting=this.secondLimit)}),1e3)))},async userLogin(){if(!this.verifyLogin())return;if(!/^\d{6}$/.test(this.smsCode))return void this.$toast("手机验证码为6位数字");const t=await r(this.smsCode,this.mobile);this.$toast("登录成功"),this.$store.commit("user/setUserInfo",t.data),setTimeout((()=>{this.$router.replace(this.$route.query.backUrl||"/user")}),1e3)}},created(){this.getCaptcha()},destroyed(){clearInterval(this.msgTimer)}},m=l,h=s(1001),d=(0,h.Z)(m,a,i,!1,null,"45e08930",null),p=d.exports}}]);
//# sourceMappingURL=348.e712c4f3.js.map